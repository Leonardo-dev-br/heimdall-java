<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: head"></head>
<body class="min-h-screen flex flex-col">
  <div th:replace="fragments/nav :: nav"></div>

  <main class="max-w-7xl mx-auto px-4 py-8 flex-1">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-3xl">Pátio</h1>
        <p class="subtitle text-sm mt-1">Gerencie as vagas e visualize o estado atual.</p>
      </div>
      <div class="flex gap-3">
        <a th:href="@{/parking/new}" class="inline-flex items-center px-4 py-2 rounded-md text-sm font-semibold shadow-md"
           style="background-color: #03A64A; color: #023; /* texto escuro sobre botão verde */">
          Novo Registro
        </a>
      </div>
    </div>

    <form method="get" class="mb-6 grid grid-cols-1 md:grid-cols-4 gap-3">
      <input name="idZona" type="number" th:value="${filter.idZona}" placeholder="Zona" class="p-2 rounded bg-[rgba(255,255,255,0.04)]" />
      <select name="preenchida" class="p-2 rounded bg-[rgba(255,255,255,0.04)]">
        <option th:value="" th:text="'Todos'">Todos</option>
        <option th:value="true" th:selected="${filter.preenchida == true}">Preenchida</option>
        <option th:value="false" th:selected="${filter.preenchida == false}">Livre</option>
      </select>
      <input name="codVaga" type="text" th:value="${filter.codVaga}" placeholder="Código da vaga" class="p-2 rounded bg-[rgba(255,255,255,0.04)]" />
      <div class="flex gap-2">
        <button type="submit" class="px-4 py-2 rounded" style="background:#026873;color:var(--text)">Filtrar</button>
        <a th:href="@{/parking}" class="px-4 py-2 rounded" style="background:transparent;border:1px solid rgba(255,255,255,0.06)">Limpar</a>
      </div>
    </form>


    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <div th:each="p : ${parkings}" class="bg-[rgba(255,255,255,0.03)] rounded-lg p-4 shadow-md">
        <div class="flex items-start justify-between">
          <div>
            <div class="text-sm text-[var(--title)]">Vaga <span class="font-bold" th:text="${p.codVaga}">A1</span></div>
            <div class="text-xs mt-1">Zona: <span th:text="${p.idZona}">1</span></div>
          </div>

          <div class="text-right">
            <span th:if="${p.preenchida}" class="inline-block px-3 py-1 rounded-full text-xs font-semibold" style="background:#BDECC7;color:#023;">OCUPADA</span>
            <span th:if="${!p.preenchida}" class="inline-block px-3 py-1 rounded-full text-xs font-semibold" style="background:#F0F9F4;color:#023;">LIVRE</span>
          </div>
        </div>

        <div class="mt-4 bg-[rgba(0,0,0,0.12)] p-3 rounded">
          <h3 class="text-lg mb-2">Estado / Histórico</h3>
          <p class="text-sm mb-2">Último status salvo: <strong th:text="${p.preenchida} ? 'Moto estacionada' : 'Vaga disponível'">Moto estacionada</strong></p>


          <a th:href="@{|/parking/${p.idVaga}/history|}" class="text-sm underline">Ver histórico</a>
        </div>
        <div class="mt-4 flex gap-2">
          <a th:href="@{|/parking/${p.idVaga}/edit|}" class="flex-1 py-2 text-center rounded" style="background:#03A64A;color:#023;">Editar</a>

          <form th:action="@{|/parking/${p.idVaga}/delete|}" method="post" onsubmit="return confirm('Excluir vaga?');">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="py-2 px-4 rounded bg-[#bf1f1f]">Excluir</button>
          </form>
        </div>
      </div>
    </div>


    <div class="mt-6 flex justify-center">
      <nav class="inline-flex gap-2">
        <a th:if="${page.hasPrevious()}" th:href="@{/parking(page=${page.number - 1}, size=${page.size})}" class="px-3 py-2 rounded bg-[rgba(255,255,255,0.03)]">Anterior</a>
        <span class="px-3 py-2 rounded bg-[rgba(255,255,255,0.02)]">Página <span th:text="${page.number + 1}">1</span> de <span th:text="${page.totalPages}">1</span></span>
        <a th:if="${page.hasNext()}" th:href="@{/parking(page=${page.number + 1}, size=${page.size})}" class="px-3 py-2 rounded bg-[rgba(255,255,255,0.03)]">Próxima</a>
      </nav>
    </div>
  </main>

  <div th:replace="fragments/footer :: footer"></div>
</body>
</html>
